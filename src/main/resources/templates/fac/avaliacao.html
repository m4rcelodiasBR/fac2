<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/mainLayout :: layout(~{::title}, ~{::section}, ~{::scripts})}">
<head>
    <title th:text="'FAC #' + ${avaliacao.id} + ' - FACDigital'">Tela de Avaliação</title>
</head>
<body>
<section>
    <!-- Cabeçalho da Página -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2" th:text="${'FAC #' + avaliacao.id + ' - ' + avaliacao.eventoDescricao}">Detalhes da FAC</h1>
    </div>

    <!-- Informações do Avaliador e Evento -->
    <div class="card mb-4">
        <div class="card-header fw-bold">
            EVENTO: <span class="text-primary" th:text="${avaliacao.eventoSigla}">EC</span>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <p class="mb-1"><strong>Descrição:</strong> <span th:text="${avaliacao.eventoDescricao}">Escala de Comando</span></p>
                    <p class="mb-1"><strong>Situação:</strong> <span th:text="${avaliacao.situacaoPromocao}">Previsão de promoção...</span></p>
                </div>
                <div class="col-md-4 text-md-end">
                    <p class="mb-1"><strong>Data Limite para Remessa:</strong></p>
                    <p class="fw-bold text-danger fs-5" th:text="${#temporals.format(avaliacao.dataLimiteRemessa, 'dd/MM/yyyy')}"></p>
                </div>
            </div>
            <hr>
            <p class="mb-1"><strong>AVALIADOR:</strong>
                <span th:text="${avaliacao.avaliador.posto.sigla}"></span>
                <span th:text="${avaliacao.avaliador.quadro}"></span>
                <span th:text="${avaliacao.avaliador.nome}"></span>
            </p>
        </div>
    </div>

    <!-- Tracker Visual de Status -->
    <div class="d-flex justify-content-around align-items-center p-3 bg-light rounded mb-4">
        <div class="text-center"
             th:classappend="${avaliacao.status.name() == 'INICIADA' ? 'fw-bold text-primary' : ''}">1. Iniciada
        </div>
        <div class="flex-grow-1 mx-3">
            <hr>
        </div>
        <div class="text-center"
             th:classappend="${avaliacao.status.name() == 'EM_PROGRESSO' ? 'fw-bold text-primary' : ''}">2. Em Progresso
        </div>
        <div class="flex-grow-1 mx-3">
            <hr>
        </div>
        <div class="text-center"
             th:classappend="${avaliacao.status.name() == 'CONCLUIDA' ? 'fw-bold text-primary' : ''}">3. Concluída
        </div>
    </div>

    <!-- Área Principal: Tabela e Foto -->
    <div class="row">
        <!-- Coluna da Tabela de Avaliados -->
        <div class="col-lg-9">
            <div class="table-responsive">
                <table class="table table-hover" id="tabela-avaliados">
                    <thead class="table-light">
                    <tr>
                        <th>ANT</th>
                        <th>NIP</th>
                        <th>Nome do Oficial</th>
                        <th>OM</th>
                        <th class="text-center">Grau</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="avaliado : ${avaliacao.avaliados}"
                        th:data-foto="${avaliado.fotoBase64}"
                        th:data-nome="${avaliado.nomeDeGuerra}"
                        th:data-nip="${avaliado.nip}">

                        <td th:text="${avaliado.antiguidade}"></td>
                        <td th:text="${avaliado.nip}"></td>
                        <td th:text="${avaliado.nome}"></td>
                        <td th:text="${avaliado.omSigla}"></td>
                        <td class="text-center">
                            <input type="text" class="form-control form-control-sm text-center grau-input" style="width: 70px;"
                                   th:value="${avaliado.grau}"
                                   th:data-avaliacao-id="${avaliacao.id}" th:data-avaliado-id="${avaliado.id}"
                                   placeholder=""/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Coluna da Foto e Detalhes -->
        <div class="col-lg-3">
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-header text-center">Oficial Selecionado</div>
                <div class="card-body text-center">
                    <img id="foto-avaliado" src="" alt="Foto do Avaliado" class="img-fluid rounded border mb-3"
                         style="width: 160px; height: 208px; object-fit: cover;"/>
                    <h5 id="nome-guerra-avaliado" class="card-title"></h5>
                    <p id="nip-avaliado" class="card-text"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Botão de Envio -->
    <div class="mt-4 text-end">
        <form th:action="@{/fac/avaliacao/{id}/enviar(id=${avaliacao.id})}" method="POST">
            <button type="submit" id="btn-enviar-avaliacao" class="btn btn-success btn-lg">Enviar Avaliação</button>
        </form>
    </div>
</section>
<th:block th:fragment="scripts">
    <script th:src="@{/js/fac.js}"></script>
</th:block>
</body>
</html>